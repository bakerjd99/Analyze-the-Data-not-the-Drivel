%\input{bmamble.tex}

\subsection*{\href{https://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/}{APL Software Archaeology .dbi Edition}}
\addcontentsline{toc}{subsection}{APL Software Archaeology .dbi Edition}


\noindent\emph{Posted: 27 Dec 2013 03:39:00}
\vspace{6pt}


%{[}caption id=``attachment\_4418'' align=``alignright''  width=``189''{]}
%\href{http://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/apltree/}{\includegraphics{apltree.png}}
%Have yourself a merry little APL Christmas.
%{[}/caption{]}

\captionsetup[floatingfigure]{labelformat=empty}
\begin{floatingfigure}[l]{0.25\textwidth}
\centering
\href{http://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/apltree/}{\includegraphics[width=0.23\textwidth]{apltree.png}}
\caption{Have yourself a merry little APL Christmas}
\label{fig:4415X0}
\end{floatingfigure} I joke that my job title should be \emph{software archaeologist} because
I often find myself resurrecting, not refactoring, code that dates to
primitive and primeval eras. The language I'm typically hired to
resurrect is APL. APL, the language with funny symbols, is a software
vampire. People keep paying us to kill it but no matter how many stakes
we pound through its heart it keeps coming back.

There are good reasons for this. APL embodies many timeless ideas and
I'm confident that programming in the future will look a lot more like
APL than many expect. If you doubt me just press the Siri button on your
iPhone and ask, ``Integrate X squared times sine X from 0 to 2.'' What
comes back has more of an APL than \texttt{QWERTYUIOP} flavor. Strange
Unicode characters are creeping into many mainstream languages. This is
a good thing because restricting programming to the miserly key sets of
ancient typewriters was, is, and always will be a spectacularly bad
idea.
\href{http://amturing.acm.org/award\_winners/iverson\_9147499.cfm}{Ken
Iverson} deserves rich accolades for pointing this out more than fifty
years ago and beating this drum incessantly during his lifetime. Iverson
taught that notation is a tool of thought and that \emph{if you care
about ideas you must care about how they are expressed.} Why is this
even remotely controversial?


%{[}caption id=``attachment\_4435'' align=``alignleft''  width=``152''{]}
%\href{http://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/siriintegral/}{\includegraphics{siriintegral.jpg}}
%Siri's results use appropriate mathematical notations. As we move away
%from keyborards programming languages and mathematical notation will
%merge. APL was way ahead of its time in this respect.
%{[}/caption{]}

%\begin{floatingfigure}[r]{0.25\textwidth}
%\centering
%\href{http://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/siriintegral/}{\includegraphics[width=0.23\textwidth]{siriintegral.jpg}}
%\caption{Siri's results use appropriate mathematical notations. As we move away
%from keyboards programming languages and mathematical notation will
%merge. APL was way ahead of its time in this respect.}
%\label{fig:4415X1}
%\end{floatingfigure} 

The genius of APL continues to exert influence on many programming
languages but APL's rise had little to do with its abstract notation and
a lot to do with how it was implemented. APL was one of the first
programming environments that \emph{nonprogrammers} could use. It was
the spreadsheet of the late 1960's and 1970's and just like spreadsheets
of today a lot of utterly horrid, poorly structured, lame amateur messes
were created with it. If you've ever cracked open a gigantic Excel model
that looks like it was developed by a roomful of quarreling ADHD
afflicted unionized chimpanzees then you know what the standard APL mess
feels like. Many programmers blamed APL for this just like gun control
advocates blame firearms for shootings. They argued that it would have
been impossible to concoct such monsters in \emph{clean} compiled
languages like
\href{https://en.wikipedia.org/wiki/Pascal\_(programming\_language)}{Pascal}.
``It wouldn't even compile.'' This is not even wrong. I've dealt with
plenty of dreadful messes that \emph{do compile!} The tool is always
neutral; don't blame the paintbrush for the painting.

\captionsetup[figure]{labelformat=empty}
\begin{SCfigure}
\centering
\href{http://bakerjd99.wordpress.com/2013/12/26/apl-software-archaeology-dbi-edition/siriintegral/}{\includegraphics[width=0.30\textwidth]{siriintegral.jpg}}
\caption{Siri's results use appropriate mathematical notations. As we move away
from keyboards programming languages and mathematical notation will
merge. APL was way ahead of its time in this respect.}
\label{fig:4415X1}
\end{SCfigure}

Allowing rubes to code yields mountains of rubbish and the occasional
ruby. It will shock many programmers to learn they are not the only
smart people in the world. It turns out that nonprogrammers occasionally
have good ideas and, miraculously, some of them can ably express their
ideas in code. Before spreadsheets such user rubies congealed in APL
where some still run. Part of my day job is extracting these precious
stones from layers and layers of kluges, hacks, patch jobs, retro-fits
and workarounds and recoding them in modern programming languages like
C\# and JavaScript.

Recently I recovered\footnote{
\texttt{.dbi} files held many gigabytes of actuarially tuned data.
  Dumping them was not an option. We either had to convert~to a new
  store or produce a component that could read old data in new
  systems.
} an ancient
inverted file system embedded in the APL systems of my employer and
rendered it in C\#. This system uses the extension \texttt{.dbi}. I
don't know who created this system; the code is old. The most recent
code comments date from the year 2000 but I am pretty sure that
\texttt{.dbi} files predate
\href{http://dl.acm.org/citation.cfm?id=28339}{component files} in
\href{http://www.apl2000.com/}{APL+WIN}, formerly
\href{https://en.wikipedia.org/wiki/Scientific\_Time\_Sharing\_Corporation}{STSC
APL}, which pushes the design back to the 1980's or earlier. I know many
APL'ers check this blog. If any of you know who created the original
\texttt{.dbi} APL code please leave a note.

Somehow this \texttt{.dbi} system survived unsupported, with few user
complaints, for decades of daily use. How is this possible?
Astonishingly, good ideas age well and the core \texttt{.dbi} idea is
inverted data. Modern \href{http://kx.com/}{high performance databases}
make heavy use of this method. Inversion is so effective that hoary old
interpreted APL code still beats compiled and optimized ADO.Net when
fetching large numeric vectors and tables.

Restoring the \texttt{.dbi} system was a two-step
process.\footnote{
Restoring old code is somewhat like
  \href{http://conceptcontrol.smugmug.com/Themes/Manipulations/Restorations-1}{restoring
  old pictures}. When working on old pictures you're always tempted to
  \emph{improve them.} With pictures you usually have a choice. This may
  not hold for old code. Changes in software may force
  updates.
} I first converted the APL
system to J. I used \href{http://www.jsoftware.com/jwiki/FrontPage}{J
because it is a close relative of APL} but not so close that you can cut
and paste. Translating nontrivial APL to J forces you to understand the
APL at the nit-bitty level. The translation to J also allowed me to fix
the APL interface. The original system used global variables, rampant
branches and other lamentable coding practices that C\# will not abide.
After matching the APL and J systems I then translated the J to C\# and
then rematched all three systems.

Comparing multiple systems is a very effective testing technique. I
found bugs in all three systems. I fixed the J and C\# bugs but left the
original APL code unchanged. Software archaeology is a delicate field.
You don't ``fix'' old code just like you don't correct errors in
cuneiform tablets. Original and important program code belongs~in
\href{http://www.computerhistory.org/}{museums} with other significant
cultural artifacts.

Original inverted file code probably belongs in a museum. This
\texttt{.dbi} APL code is old but it certainly derives from earlier
programs so it's not museum worthy. Even if it was the APL and C\#
\texttt{.dbi} systems belong to my employer. However, I am placing the J
scaffold version, which matches the performance of the other systems,
into the public domain. The script
is~\href{https://github.com/bakerjd99/jacks/tree/master/dbi}{available
on GitHub}. The \texttt{.dbi} system gets right down to bits in some cases and
illustrates some J techniques for dealing with indexed binary inverted
file data. Enjoy!

%\begin{center}\rule{3in}{0.4pt}\end{center}

%\begin{enumerate}
%\item
%  ~\texttt{.dbi} files held many gigabytes of actuarially tuned data.
%  Dumping them was not an option. We either had to convert~to a new
%  store or produce a component that could read old data in new
%  systems.\hyperref[fnref1]{↩}
%\item
%  Restoring old code is somewhat like
%  \href{http://conceptcontrol.smugmug.com/Themes/Manipulations/Restorations-1}{restoring
%  old pictures}. When working on old pictures you're always tempted to
%  \emph{improve them.} With pictures you usually have a choice. This may
%  not hold for old code. Changes in software may force
%  updates.\hyperref[fnref2]{↩}
%\end{enumerate}

%\captionsetup[floatingfigure]{labelformat=empty}
%\begin{figure}[htbp]
%\begin{floatingfigure}[l]{0.25\textwidth}
%\centering
%\includegraphics[width=0.23\textwidth]{apltree.png}
%\caption{~~~IMCAPTION~~~}
%\label{fig:4415X0}
%\end{floatingfigure}
%\end{figure}

%\captionsetup[floatingfigure]{labelformat=empty}
%\begin{figure}[htbp]
%\begin{floatingfigure}[l]{0.25\textwidth}
%\centering
%\includegraphics[width=0.23\textwidth]{siriintegral.jpg}
%\caption{~~~IMCAPTION~~~}
%\label{fig:4415X1}
%\end{floatingfigure}
%\end{figure}


%\end{document}